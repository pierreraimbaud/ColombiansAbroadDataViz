<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <style>

    .bar {
      fill: steelblue;
    }

    .bar:hover {
      fill: brown;
    }

    .axis--x path {
      display: none;
    }

    </style>

    <div id = "svgcontainer">
          <h3>Colombians registered abroad</h3>
    </div>

    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>

      // Margin data for viz
      const width = 800;
      const height = 400;
      const margin = {top: 40, right: 120, bottom: 50, left: 100};
      const iwidth = width - margin.left -margin.right;
      const iheight = height - margin.top - margin.bottom;

      d3.select('h3').style('color', 'green');
      d3.select('h3').style('font-size', '24px');

  // SVG and g elements
      var svg = d3.select("#svgcontainer")
          .append("svg")
          .attr("width", iwidth + margin.left + margin.right)
          .attr("height", iheight + margin.top + margin.bottom);
      var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var dataOrigin;

      var x = d3.scaleBand();
          // X domain (as the numbers of elements we could allow us to write them manually, otherwise make it automatic
          //.domain([2012,2013,2014,2015,2016,2017,2018])
      x.range([0, iwidth])
        .paddingInner(1);
        
      // Y scale definition
      var y = d3.scaleLinear();
      //.domain([0, d3.max(dataByYear, d => d.value)])
      y.range([iheight, 0]);

      // var promise1 = new Promise(function(resolve, reject) {
      //   d3.csv('https://raw.githubusercontent.com/pierreraimbaud/ColombiansAbroadViz/master/GroupByCountryFile.csv', function(dataOrigin) {
      //     console.log(dataOrigin);
      //      dataCountryList = dataOrigin;
      //      //debugger
      //   });
      // });

      // promise1.then(function(value) {
      //   console.log(value);
      //   debugger
      //   dothejob();
      // // expected output: "Success!"
      // });

      d3.csv('https://raw.githubusercontent.com/pierreraimbaud/ColombiansAbroadViz/master/Colombianos_registrados_en_el_exterior.csv').then(function(data) {
          console.log(data);
          dataOrigin = data;
          dothejob();
      });
     
      function dothejob()
      {
        var dataCountryList = d3.nest().key(function(d)
                                                  {
                                                      return d.País;
                                                    
                                                 })
                                             .rollup(function(d)
                                                    {
                                                          return d3.sum(d, 
                                                          function(d)
                                                          {
                                                            return d."Cantidad de personas"
                                                          }
                                                         )
                                         
                                                    }
                                                   )
                                            .entries(dataOrigin);
        console.log(dataCountryList);
        //debugger
        // X scale definition      
        x.domain(dataCountryList.map(function(d) { return d.País; }));
        y.domain([0, d3.max(dataCountryList, function(d) { return d.value; })]);

        // Axis x
        g.append("g")
            .call(d3.axisBottom(x))
            .attr("transform", `translate(0,${iheight})`);
        
        // Axis y  
        g.append("g")
            .call(d3.axisLeft(y));

        const line = d3.line()
          .x( d=> x(d.key))
          .y( d=> y(d.value));
        
        // Path element
        g.append("path")
          .attr("class", "line")
          .attr("d", line(dataCountryList))
          .style("stroke", "salmon")
          .style("fill", "none");
      }


         // var dataCountryListVal = d3.set(dataOrigin.map( d => d.key )).values();
    </script>

    <div class="wrapper">
      <header>
        <h1><a href="">auto-link</a></h1>
        <p></p>
        <p class="view"><a href="https://github.com/pierreraimbaud/ColombiansAbroadViz">Project URL on GitHub <small>pierreraimbaud/ColombiansAbroadViz</small></a></p>
      </header>
      <section>MD zone</section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/pierreraimbaud">pierreraimbaud</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src=""></script>
    
  </body>
</html>